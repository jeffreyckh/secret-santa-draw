<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>üéÖ Secret Santa Draw</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background: linear-gradient(to bottom, #ffe6f0, #fff);
    text-align: center;
    overflow-x: hidden;
    position: relative;
}
h2 {
    color: #c0392b;
    text-shadow: 2px 2px 5px #fff;
}
button {
    padding: 15px 30px;
    font-size: 20px;
    margin-top: 20px;
    cursor: pointer;
    border-radius: 15px;
    background-color: #27ae60;
    color: white;
    border: none;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
}
button:hover { background-color: #2ecc71; }
#resultCard {
    margin-top: 30px;
    padding: 30px;
    background: #27ae60;
    color: white;
    border-radius: 20px;
    font-size: 24px;
    display: none;
    box-shadow: 0 0 15px rgba(0,0,0,0.3);
    animation: pop 0.5s ease-out;
}
@keyframes pop {
    0% { transform: scale(0.5); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}
.snowflake {
    position: fixed;
    top: -10px;
    color: #fff;
    user-select: none;
    z-index: 9999;
    font-size: 1em;
}
.confetti {
    position: fixed;
    width: 10px;
    height: 10px;
    background-color: red;
    opacity: 0.8;
    z-index: 9999;
    pointer-events: none;
}
</style>
</head>
<body>

<h2>üéÖ Secret Santa Draw</h2>
<button onclick="drawName()">Draw üéÅ</button>

<div id="resultCard"></div>

<!-- Snow animation -->
<script>
const snowCount = 50;
for(let i=0;i<snowCount;i++){
    const snow = document.createElement('div');
    snow.className = 'snowflake';
    snow.innerHTML = '‚ùÑ';
    snow.style.left = Math.random()*100 + 'vw';
    snow.style.fontSize = 12 + Math.random()*20 + 'px';
    snow.style.animationDuration = 5 + Math.random()*10 + 's';
    snow.style.opacity = 0.5 + Math.random()*0.5;
    document.body.appendChild(snow);
}
</script>

<script>
// Get participant name from URL
function getParticipantFromURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get("user");
}

// Confetti effect
function launchConfetti() {
    const colors = ['#e74c3c','#f1c40f','#2ecc71','#3498db','#9b59b6'];
    for(let i=0;i<100;i++){
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
        confetti.style.left = Math.random()*100 + 'vw';
        confetti.style.top = '-10px';
        confetti.style.width = 5 + Math.random()*10 + 'px';
        confetti.style.height = 5 + Math.random()*10 + 'px';
        confetti.style.opacity = 0.7 + Math.random()*0.3;
        document.body.appendChild(confetti);

        const fallDuration = 2000 + Math.random()*2000;
        confetti.animate([
            { transform: `translateY(0px) rotate(0deg)` },
            { transform: `translateY(${window.innerHeight + 20}px) rotate(${Math.random()*360}deg)` }
        ], { duration: fallDuration, iterations: 1, easing: 'linear' });

        setTimeout(()=>{ confetti.remove(); }, fallDuration);
    }
}

function drawName() {
    const participant = getParticipantFromURL();
    if(!participant){
        alert("Invalid link. Please open your private link provided by the organizer.");
        return;
    }

    let assignments = JSON.parse(localStorage.getItem("secretSantaAssignments") || "{}");
    let remaining = JSON.parse(localStorage.getItem("secretSantaRemaining") || "[]");

    if(!assignments[participant]){
        alert("No assignment found for your name. Contact organizer.");
        return;
    }

    if(!remaining.includes(participant)){
        alert("You have already drawn your name.");
        return;
    }

    const assignedName = assignments[participant];

    // Remove participant from remaining pool
    const index = remaining.indexOf(participant);
    if(index > -1){
        remaining.splice(index,1);
    }
    localStorage.setItem("secretSantaRemaining", JSON.stringify(remaining));

    // Show Christmas-themed result card
    const card = document.getElementById("resultCard");
    card.innerHTML = "üéÅ Your assigned person is:<br><strong>" + assignedName + "</strong>";
    card.style.display = "block";

    // Launch confetti
    launchConfetti();
}
</script>

</body>
</html>
